{% extends "base.html" %}
{% block content %}

<div id="section-analisi" class="content-section">
    <div class="card p-4 rounded-4 shadow-sm container">
        <h4>Analisi Vendite</h4>
        <p>Statistiche e dati sulle vendite.</p>

        <!-- Statistiche Oggi (dall'apertura alla chiusura) -->
        <div class="row g-3 mb-4 text-center">
            <div class="col-md-3">
                <div class="card bg-primary text-white rounded-4 shadow-sm p-3">
                    <h6>Incasso Oggi</h6>
                    <h3>€{{ incasso_oggi }}</h3>
                    <small class="text-muted">Dall'apertura alla chiusura</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white rounded-4 shadow-sm p-3">
                    <h6>Ordini Oggi</h6>
                    <h3>{{ ordini_oggi }}</h3>
                    <small class="text-muted">Dall'apertura alla chiusura</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-dark rounded-4 shadow-sm p-3">
                    <h6>Scontrino Medio Oggi</h6>
                    <h3>€{{ scontrino_oggi }}</h3>
                    <small class="text-muted">Dall'apertura alla chiusura</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-secondary text-white rounded-4 shadow-sm p-3">
                    <h6>Tempo Medio Oggi</h6>
                    <h3>{{ tempo_oggi }}</h3>
                    <small class="text-muted">Dall'apertura alla chiusura</small>
                </div>
            </div>
        </div>

        <!-- Statistiche Settimanali -->
        <div class="row g-3 mb-4 text-center">
            <div class="col-md-3">
                <div class="card bg-primary text-white rounded-4 shadow-sm p-3">
                    <h6>Incasso Settimana</h6>
                    <h3>€{{ incasso_settimana }}</h3>
                    <small class="text-success fw-semibold">{{ incasso_var }}% vs settimana scorsa</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white rounded-4 shadow-sm p-3">
                    <h6>Ordini Settimana</h6>
                    <h3>{{ ordini_settimana }}</h3>
                    <small class="text-success fw-semibold">{{ ordini_var }}% vs settimana scorsa</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-dark rounded-4 shadow-sm p-3">
                    <h6>Scontrino Medio</h6>
                    <h3>€{{ scontrino_medio }}</h3>
                    <small class="text-success fw-semibold">{{ scontrino_var }}% vs settimana scorsa</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-secondary text-white rounded-4 shadow-sm p-3">
                    <h6>Tempo Medio</h6>
                    <h3>{{ tempo_medio }}</h3>
                    <small class="text-danger fw-semibold">{{ tempo_var }} vs settimana scorsa</small>
                </div>
            </div>
        </div>

        <!-- Grafici -->
        <div class="row g-4">
            <!-- Vendite Settimanali (orizzontale) -->
            <div class="col-md-7">
                <div class="card shadow-sm rounded-4 p-3">
                    <h5 class="card-title mb-3">Vendite Settimanali</h5>
                    <div style="height: 350px;">
                        <canvas id="venditeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Ordini per Categoria -->
            {% if categorie_labels and categorie_dati %}
            <div class="col-md-5">
                <div class="card shadow-sm rounded-4 p-3">
                    <h5 class="card-title mb-3">Ordini per Categoria</h5>
                    <div style="height: 350px;">
                        <canvas id="categoriaChart"></canvas>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Ordini per ora -->
            <div class="col-md-7">
                <div class="card shadow-sm rounded-4 p-3">
                    <h5 class="card-title mb-3">Ordini per Ora</h5>
                    <div style="height: 300px;">
                        <canvas id="ordiniOraChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Top 10 prodotti (orizzontale) -->
            <div class="col-md-5">
                <div class="card shadow-sm rounded-4 p-3">
                    <h5 class="card-title mb-3">Articoli Più Venduti (Top 10)</h5>
                    {% if top_prodotti %}
                        <div style="height: 350px;">
                            <canvas id="topProdottiChart"></canvas>
                        </div>
                    {% else %}
                        <p class="text-muted">Nessun dato disponibile</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Grafico Vendite Settimanali (orizzontale)
new Chart(document.getElementById('venditeChart'), {
    type: 'bar',
    data: {
        labels: {{ vendite_labels | tojson }},
        datasets: [{
            label: 'Vendite (€)',
            data: {{ vendite_dati | tojson }},
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        indexAxis: 'x',
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Totale Vendite (€)'
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Giorno della settimana'
                }
            }
        },
        plugins: {
            legend: { display: false },
            tooltip: { enabled: true }
        }
    }
});

// Grafico Ordini per Categoria
{% if categorie_labels and categorie_dati %}
new Chart(document.getElementById('categoriaChart'), {
    type: 'pie',
    data: {
        labels: {{ categorie_labels | tojson }},
        datasets: [{
            data: {{ categorie_dati | tojson }},
            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#8BC34A', '#FF9800']
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});
{% endif %}

// Grafico Ordini per Ora
new Chart(document.getElementById('ordiniOraChart'), {
    type: 'line',
    data: {
        labels: {{ ore_labels | tojson }},
        datasets: [{
            label: 'Ordini',
            data: {{ ore_dati | tojson }},
            borderColor: '#FF6384',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});

// Grafico Top Prodotti (orizzontale)
{% if top_prodotti %}
new Chart(document.getElementById('topProdottiChart'), {
    type: 'bar',
    data: {
        labels: {{ top_prodotti | map(attribute='nome') | list | tojson }},
        datasets: [{
            label: 'Quantità vendute',
            data: {{ top_prodotti | map(attribute='quantita') | list | tojson }},
            backgroundColor: 'rgba(75, 192, 192, 0.8)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    },
    options: {
        indexAxis: 'x',
        responsive: true,
        scales: {
            x: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Quantità vendute'
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Prodotti'
                }
            }
        },
        plugins: {
            legend: { display: true, position: 'top' },
            tooltip: { enabled: true }
        }
    }
});
{% endif %}
</script>

{% endblock %}
