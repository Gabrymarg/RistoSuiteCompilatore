{% extends "base.html" %}
{% block content %}

<div id="section-analisi" class="content-section">
    <div class="container glass-container-stats p-5">
        <h2 class="text-center text-white mb-5">üìà Analisi Vendite</h2>


        <!-- Statistiche Oggi -->
        <div class="row g-4 mb-4 text-center">
            <div class="col-md-3">
                <div class="glass-card p-4">
                    <h6 class="text-white-50"><i class="bi bi-cash-coin"></i> Incasso Oggi</h6>
                    <h3 class="text-white">‚Ç¨{{ incasso_oggi }}</h3>
                </div>
            </div>
            <div class="col-md-3 ">
                <div class="glass-card p-4 ">
                    <h6 class="text-white-50"><i class="bi bi-receipt"></i> Ordini Oggi</h6>
                    <h3 class="text-white">{{ ordini_oggi }}</h3>
                </div>
            </div>
            <div class="col-md-3 ">
                <div class="glass-card p-4">
                    <h6 class="text-white-50"><i class="bi bi-basket"></i> Scontrino Medio</h6>
                    <h3 class="text-white">‚Ç¨{{ scontrino_oggi }}</h3>
                </div>
            </div>
            <div class="col-md-3 ">
                <div class="glass-card p-4">
                    <h6 class="text-white-50"><i class="bi bi-clock-history"></i> Tempo Medio</h6>
                    <h3 class="text-white">{{ tempo_oggi }}</h3>
                </div>
            </div>
        </div>

        <!-- Statistiche Settimanali -->
        <div class="row g-4 mb-5 text-center">
            <div class="col-md-3">
                <div class="glass-card p-4">
                    <h6 class="text-white-50">Incasso Settimana</h6>
                    <h3 class="text-white">‚Ç¨{{ incasso_settimana }}</h3>
                    <small class="{% if incasso_var|float >= 0 %}text-success{% else %}text-danger{% endif %} fw-semibold">
                        {{ incasso_var }}% vs settimana scorsa
                    </small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="glass-card p-4">
                    <h6 class="text-white-50">Ordini Settimana</h6>
                    <h3 class="text-white">{{ ordini_settimana }}</h3>
                    <small class="{% if ordini_var|float >= 0 %}text-success{% else %}text-danger{% endif %} fw-semibold">
                        {{ ordini_var }}% vs settimana scorsa
                    </small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="glass-card p-4">
                    <h6 class="text-white-50">Scontrino Medio</h6>
                    <h3 class="text-white">‚Ç¨{{ scontrino_medio }}</h3>
                    <small class="{% if scontrino_var|float >= 0 %}text-success{% else %}text-danger{% endif %} fw-semibold">
                        {{ scontrino_var }}% vs settimana scorsa
                    </small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="glass-card p-4">
                    <h6 class="text-white-50">Tempo Medio</h6>
                    <h3 class="text-white">{{ tempo_medio }}</h3>
                    <small class="{% if tempo_var|float <= 0 %}text-success{% else %}text-danger{% endif %} fw-semibold">
                        {{ tempo_var }} vs settimana scorsa
                    </small>
                </div>
            </div>
        </div>

        <!-- Grafici -->
        <div class="row g-4">
            <div class="col-md-6 ">
                <div class="glass-card p-3">
                    <h5 class="text-white mb-3">üìä Vendite Settimanali</h5>
                    <div style="height: 350px;">
                        <canvas id="venditeChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="glass-card p-3">
                    <h5 class="text-white mb-3">üì¶ Ordini per Categoria</h5>
                    <div style="height: 350px;">
                        <canvas id="categoriaChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="glass-card p-3">
                    <h5 class="text-white mb-3">üïí Ordini per Ora</h5>
                    <div style="height: 350px;">
                        <canvas id="ordiniOraChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="glass-card p-3">
                    <h5 class="text-white mb-3">üèÜ Top Prodotti</h5>
                    <div style="height: 350px;">
                        <canvas id="topProdottiChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
// Gradient helper
function createGradient(ctx, color1, color2) {
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, color1);
    gradient.addColorStop(1, color2);
    return gradient;
}

// Vendite Settimanali
{% if vendite_labels and vendite_dati %}
new Chart(document.getElementById('venditeChart'), {
    type: 'bar',
    data: {
        labels: {{ vendite_labels | tojson }},
        datasets: [{
            label: 'Vendite (‚Ç¨)',
            data: {{ vendite_dati | tojson }},
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: { title: { display: true, text: 'Giorno' }, ticks: { color: '#ddd' } },
            y: { beginAtZero: true, title: { display: true, text: 'Vendite (‚Ç¨)' }, ticks: { color: '#ddd' } }
        },
        plugins: { legend: { labels: { color: '#fff' } } }
    }
});
{% endif %}

// Categoria (Pie)
{% if categorie_labels and categorie_dati %}
new Chart(document.getElementById('categoriaChart'), {
    type: 'pie',
    data: {
        labels: {{ categorie_labels | tojson }},
        datasets: [{
            data: {{ categorie_dati | tojson }},
            backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#8BC34A','#FF9800','#9C27B0','#00BCD4']
        }]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff' } } } }
});
{% endif %}

// Ordini per Ora
{% if ore_labels and ore_dati %}
new Chart(document.getElementById('ordiniOraChart'), {
    type: 'line',
    data: {
        labels: {{ ore_labels | tojson }},
        datasets: [{
            label: 'Ordini',
            data: {{ ore_dati | tojson }},
            borderColor: '#FF6384',
            backgroundColor: 'rgba(255,99,132,0.3)',
            fill: true,
            tension: 0.3
        }]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff' } } } }
});
{% endif %}

// Top Prodotti
{% if top_prodotti %}
new Chart(document.getElementById('topProdottiChart'), {
    type: 'bar',
    data: {
        labels: {{ top_prodotti | map(attribute='nome') | list | tojson }},
        datasets: [{
            label: 'Quantit√† vendute',
            data: {{ top_prodotti | map(attribute='quantita') | list | tojson }},
            backgroundColor: 'rgba(75, 192, 192, 0.6)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    },
    options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: { beginAtZero: true, ticks: { color: '#ddd' } },
            y: { ticks: { color: '#ddd' } }
        },
        plugins: { legend: { labels: { color: '#fff' } } }
    }
});
{% endif %}
</script>

{% endblock %}
