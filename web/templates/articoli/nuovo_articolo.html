{% extends "base.html" %}
{% block content %}
  <!-- Titolo + tasto indietro a destra -->
  <div class="d-flex justify-content-between mb-3 ">
    <h2>Nuovo Articolo</h2>
    <a href="{{ url_for('lista_articoli') }}" class="btn btn-secondary mb-3">Indietro</a>
  </div>

  <form method="POST" class="form-articoli">
    <div class="mb-3">
      <label>Nome</label>
      <input type="text" name="nome" required>
    </div>

    <div class="mb-3">
      <label>Descrizione</label>
      <textarea name="descrizione"></textarea>
    </div>

    <div class="mb-3">
      <label type="text">Prezzo</label>
      <input type="number" step="0.01" name="prezzo" min="0" required>
    </div>

    <div class="mb-3 gap-3 d-flex justify-content-between align-items-center filtro-liquid-glass">
      <label class="">Categoria</label>
      <select name="categoria" class="form-select liquid-select">
        <option value="">-- Nessuna categoria --</option>
        {% for cat in categorie %}
        <option value="{{ cat['id_categoria'] }}">{{ cat['nome'] }}</option>
        {% endfor %}
      </select>
    </div>

    <h4>Ingredienti</h4>
    <p>Seleziona gli ingredienti e specifica la quantità usata per questo articolo:</p>

    <div class="ingredienti-box">
      <input type="text" id="searchIngredienti" class="form-control mb-2" placeholder="Cerca ingrediente..."
        onkeyup="filterIngredienti()">

      <ul class="list-group" id="ingredientiList">
        {% for ingr in ingredienti %}
        <li class="list-group-item align-items-center" style="display: flex;">
          <input class="form-check-input me-2" type="checkbox" id="ingr{{ ingr[0] }}" name="ingredienti"
            value="{{ ingr[0] }}">
          <label class="form-check-label flex-grow-1" for="ingr{{ ingr[0] }}">{{ ingr[1] }}</label>

          {% if usa_giacenza %}
          <input type="number" step="0.01" min="0" name="quantita_ingredienti_{{ ingr[0] }}" class="form-control"
            style="width: 100px;" placeholder="Quantità">
          {% endif %}
        </li>
        {% endfor %}
        <li id="noIngredientiMsg" class="list-group-item text-center" style="display:none;">Nessun ingrediente trovato.
        </li>
      </ul>
    </div>

    <button class="btn btn-primary mt-3">Salva</button>
  </form>

<script>
  function filterIngredienti() {
    const input = document.getElementById('searchIngredienti');
    const filter = input.value.toLowerCase();
    const ul = document.getElementById('ingredientiList');
    const items = ul.getElementsByTagName('li');
    let found = false;

    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      if (item.id === "noIngredientiMsg") continue;
      const label = item.querySelector('label');
      const text = label.textContent.toLowerCase();
      if (text.includes(filter)) {
        item.style.display = "flex";
        found = true;
      } else {
        item.style.display = "none";
      }
    }
    document.getElementById('noIngredientiMsg').style.display = found ? "none" : "block";
  }
</script>

{% endblock %}