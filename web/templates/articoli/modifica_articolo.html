{% extends "base.html" %}
{% block content %}


<style>
  /* Contenitore principale 
.container-articoli {
  width: 100%;
  max-width: 900px;
  margin: 2rem auto;
  padding: 1rem;
}
 h2 {
  font-weight: 600;
} */

  /* Titolo e tasto indietro */
  .header-form {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }



  /* Form Liquid Glass */
  form {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(8px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  form input[type="text"],
  form input[type="number"],
  form textarea,
  form select {
    width: 100%;
    padding: 0.5rem 0.75rem;
    margin-bottom: 1rem;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    background: rgba(255, 255, 255, 0.08);
    color: #fff;
    backdrop-filter: blur(8px);
    outline: none;
    transition: transform 0.2s, box-shadow 0.2s;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    cursor: pointer;
  }

  form input[type="text"]:focus,
  form input[type="number"]:focus,
  form textarea:focus,
  form select:focus {
    transform: scale(1.02);
    box-shadow: 0 4px 14px rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.12);
  }

  /* Bottoni */
  .btn {
    border-radius: 10px;
    font-weight: 600;
    padding: 0.4rem 0.8rem;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .btn-primary {
    background: linear-gradient(135deg, #6bd4ff 0%, #6b8bff 100%);
    color: #fff;
    border: none;
  }

  .btn-primary:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(107, 139, 255, 0.2);
  }

  .btn-secondary {
    background: linear-gradient(135deg, #8888ff 0%, #5555aa 100%);
    color: #fff;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .btn-secondary:hover {
    transform: scale(1.05);
  }



  /* Lista ingredienti scrollabile */
  .ingredienti-box {
    max-height: 350px;
    overflow-y: auto;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    backdrop-filter: blur(8px);
  }

  .ingredienti-box::-webkit-scrollbar {
    width: 6px;
  }

  .ingredienti-box::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
  }

  .ingredienti-box::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
  }

  /* List group */
  .list-group-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    margin-bottom: 0.4rem;
    display: flex;
    align-items: center;
    padding: 0.5rem;
    backdrop-filter: blur(6px);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .list-group-item:hover {
    transform: scale(1.02);
    box-shadow: 0 6px 20px rgba(255, 255, 255, 0.1);
  }

  #noIngredientiMsg {
    background: rgba(255, 255, 255, 0.03);
    color: rgba(255, 255, 255, 0.7);
  }
</style>

<div class="container-articoli">

  <!-- Header con tasto indietro -->
  <div class="header-form">
    <h2>Modifica Articolo</h2>
    <a href="{{ url_for('lista_articoli') }}" class="btn btn-secondary">Indietro</a>
  </div>

  <form method="POST">
    <div class="mb-3">
      <label>Nome</label>
      <input type="text" name="nome" required value="{{ articolo['nome'] }}">
    </div>

    <div class="mb-3">
      <label>Descrizione</label>
      <textarea name="descrizione">{{ articolo['descrizione'] }}</textarea>
    </div>

    <div class="mb-3">
      <label>Prezzo</label>
      <input type="number" step="0.01" name="prezzo" min="0" required value="{{ articolo['prezzo'] }}">
    </div>

    <div class="mb-3 filtro-liquid-glass full-width">
      <label>Categoria</label>
      <select name="categoria" class="form-select liquid-select">
        <option value="">-- Nessuna categoria --</option>
        {% for cat in categorie %}
        <option value="{{ cat['id_categoria'] }}" {% if articolo['id_categoria']==cat['id_categoria'] %}selected{% endif
          %}>
          {{ cat['nome'] }}
        </option>
        {% endfor %}
      </select>
    </div>

    <h4>Ingredienti</h4>
    <p>Seleziona gli ingredienti e modifica la quantità se necessario:</p>

    <div class="ingredienti-box">
      <input type="text" id="searchIngredienti" class="form-control mb-2" placeholder="Cerca ingrediente..."
        onkeyup="filterIngredienti()">
      <ul class="list-group" id="ingredientiList">
        {% for ingr in ingredienti %}
        {% set qta = articoli_ingredienti.get(ingr['id_ingrediente'], 0) %}
        <li class="list-group-item align-items-center">
          <input class="form-check-input me-2" type="checkbox" id="ingr{{ ingr['id_ingrediente'] }}" name="ingredienti"
            value="{{ ingr['id_ingrediente'] }}" {% if qta|float> 0 %}checked{% endif %}>
          <label class="form-check-label flex-grow-1" for="ingr{{ ingr['id_ingrediente'] }}">{{ ingr['nome'] }}</label>
          {% if usa_giacenza %}
          <input type="number" step="0.01" min="0" name="quantita_ingredienti_{{ ingr['id_ingrediente'] }}"
            class="form-control" style="width: 100px;" placeholder="Quantità"
            value="{{ qta if qta|float > 0 else '' }}">
          {% endif %}
        </li>
        {% endfor %}
        <li id="noIngredientiMsg" class="list-group-item text-center" style="display:none;">Nessun ingrediente trovato.
        </li>
      </ul>
    </div>

    <button class="btn btn-primary mt-3">Aggiorna</button>
  </form>
</div>

<script>
  function filterIngredienti() {
    const input = document.getElementById('searchIngredienti');
    const filter = input.value.toLowerCase();
    const ul = document.getElementById('ingredientiList');
    const items = ul.getElementsByTagName('li');
    let found = false;

    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      if (item.id === "noIngredientiMsg") continue;
      const label = item.querySelector('label');
      const text = label.textContent.toLowerCase();
      if (text.includes(filter)) {
        item.style.display = "flex";
        found = true;
      } else {
        item.style.display = "none";
      }
    }
    document.getElementById('noIngredientiMsg').style.display = found ? "none" : "block";
  }
</script>

{% endblock %}