{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between mb-3">
<h2>Ingredienti Magazzino</h2>

<div class="mb-3">
    <a href="{{ url_for('nuovo_ingrediente') }}" class="btn btn-success">Nuovo Ingrediente</a>
    </div>
</div>
    {% if usa_giacenza %}
        <table class="table-container glass-table align-items-center text-center">
            <thead>
                <tr>
                    <th class="text-center">Nome</th>
                    <th class="text-center">Quantità</th>
                    <th class="text-center">Unità di misura</th>
                    <th class="text-center">Descrizione</th>
                    <th class="text-center">Prezzo Unitario</th>
                    <th class="text-center">Scorta Minima</th>
                    <th class="text-center">Scorta Massima</th>
                    <th class="text-center">Allergene</th>
                    <th class="text-center">Fornitore</th>
                    <th class="text-center">Azioni</th>
                </tr>
            </thead>
            <tbody>
                {% for ing in ingredienti %}
                <tr>
                    <td>{{ ing['nome'] }}</td>
                    <td>{{ ing['quantita'] }}</td>
                    <td>{{ ing['unita_misura'] }}</td>
                    <td>{{ ing['descrizione'] }}</td>
                    <td>€ {{ '%.2f'|format(ing['prezzo_unitario']) }}</td>
                    <td>{{ ing['scorta_minima'] }}</td>
                    <td>{{ ing['scorta_massima'] }}</td>
                    <td>{{ ing['allergene_nome'] if ing['allergene_nome'] else '-' }}</td>
                    <td>{{ ing['fornitore_nome'] if ing['fornitore_nome'] else '-' }}</td>
                    <td>
                        <div class="d-flex gap-1">
                        <a href="{{ url_for('modifica_ingrediente', id_ingrediente=ing['id_ingrediente']) }}" class="btn btn-primary btn-sm"><i class="bi bi-pen-fill"></i></a>
                        <button type="button" class="btn btn-danger btn-sm btn-elimina" data-action="{{ url_for('elimina_ingrediente', id_ingrediente=ing['id_ingrediente']) }}"><i class="bi bi-trash-fill"></i></button>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="10" class="text-center">Nessun ingrediente trovato.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <table class="table-container glass-table align-items-center text-center">
            <thead>
                <tr>
                    <th class="text-center">Nome</th>
                    <th class="text-center">Descrizione</th>
                    <th class="text-center">Allergene</th>
                    <th class="text-center">Fornitore</th>
                    <th class="text-center">Azioni</th>
                </tr>
            </thead>
            <tbody>
                {% for ing in ingredienti %}
                <tr>
                    <td>{{ ing['nome'] }}</td>
                    <td>{{ ing['descrizione'] }}</td>
                    <td>{{ ing['allergene_nome'] if ing['allergene_nome'] else '-' }}</td>
                    <td>{{ ing['fornitore_nome'] if ing['fornitore_nome'] else '-' }}</td>
                    <td>
                        <div class="d-flex gap-1">
                        <a href="{{ url_for('modifica_ingrediente', id_ingrediente=ing['id_ingrediente']) }}" class="btn btn-primary btn-sm"><i class="bi bi-pen-fill"></i></a>
                        <button type="button" class="btn btn-danger btn-sm btn-elimina" data-action="{{ url_for('elimina_ingrediente', id_ingrediente=ing['id_ingrediente']) }}"><i class="bi bi-trash-fill"></i></button>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="10" class="text-center">Nessun ingrediente trovato.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}


<!-- Form POST invisibile per eliminazione -->
<form id="deleteForm" action="" method="POST" style="display:none;"></form>

<!-- Modal Eliminazione -->
<div id="confirmModal" class="fade-modal">
  <div class="modal-content glass-container p-4">
    <h3 style="margin-bottom: 1rem;">Conferma Eliminazione</h3>
    <p>Sei sicuro di voler eliminare questo ingrediente?</p>
    <div class="modal-buttons mt-3">
      <button id="cancelBtn" class="btn btn-secondary me-2">Annulla</button>
      <button id="confirmBtn" class="btn btn-danger">Elimina</button>
    </div>
  </div>
</div>


{% endblock %}
